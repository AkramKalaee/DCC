In contrast to previous works employingpre-trained deep networks as a black box to produce features, our methodleverages a deep architecture trained for the specific task of image retrieval.Our contribution is twofold: (i) we leverage a ranking framework to learnconvolution and projection weights that are used to build the region features;and (ii) we employ a region proposal network to learn which regions should bepooled to form the final global descriptor.