# Image2Graph

## How to run?

The required packages are listed in [requirements.txt](requirements.txt). The following command could be used to install these packages in the target Python environment:

```
pip install -r requirements.txt
```

### Detailed Instructions

Below are more detailed sample commands to create a new environment named 'i2g' using conda command line, to install the requirements, and to run the notebook using this new environment as its kernel:

```
conda create --name i2g python=3.6
activate i2g
cd 'path-to-image2graph-folder'
pip install -r requirements.txt
python -m ipykernel install --user --name=i2g
jupyter notebook
```

Select the kernel 'i2g' in the notebook.

### OS Based Differences

<b>For Windows:</b> 

Tesseract needs to be installed using the installer from the following link: https://github.com/UB-Mannheim/tesseract/wiki
Please make sure that the following line of code is uncommented in the notebook, and has the correct path to the tesseract executable in your local.

```
pytesseract.pytesseract.tesseract_cmd = r"C:\Program Files\Tesseract-OCR\tesseract.exe"
```

<b>For Linux based systems:</b> 

Please make sure that the above line is commented in the notebook.

If you encounter any issues, please feel free to contact the authors.

## Notebook

We provide a [notebook](FigAnalysis/ShapeExtraction/DemoScript.ipynb) implementing the image analysis (shape, text and arrow detection), as detailed in our [report](reports/milestone3/). Sample input images are provided in the [input folder](FigAnalysis/ShapeExtraction/Input/), and the outputs that are generated by the notebook are saved to the [output folders](FigAnalysis/ShapeExtraction/Output/). The notebook generates two outputs for each input image:

- An output image annotating the detected shapes, text and arrows (located in the [OpImage folder](FigAnalysis/ShapeExtraction/Output/OpImage)).
- A list of relationships (graph) between the detected components (located in the [OpGraph folder](FigAnalysis/ShapeExtraction/Output/OpGraph)).

To run the notebook on new images, it is sufficient to replace the contents of the [input folder](FigAnalysis/ShapeExtraction/Input/) with the new images to test. A sample input image and corresponding outputs are provided below:

Input Image:
<p align="center">
 <img align="center" width="700px" src="FigAnalysis/ShapeExtraction/Input/fig1502.05689-Figure2-1.png" alt="sampleinput1">
</p>

Output Image:
<p align="center">
 <img align="center" width="700px" src="FigAnalysis/ShapeExtraction/Output/OpImage/opfig1502.05689-Figure2-1.png" alt="sampleoutput1">
</p>

Output Graph:

```
Component number 6 "has description": 1444 
Component number 6 "has type": conv 
Component number 6 "has description":  2  
Component number 6 "has description": relu 
Component number 6 "has type": conv 
Component number 6 "has description": 5x5  
Component number 6 "has type": maxpool 
Component number 6 "has description": 2x22x ing 
Component number 7 "has description": 3d 
Component number 7 "has type": conv 
Component number 7 "has description": 4   
Component number 7 "has description": relu 
Component number 7 "has type": conv 
Component number 7 "has description": 7x7  
Component number 7 "has type": maxpool 
Component number 7 "has description": 2x2ing 
Component number 5 "has description": 367 
Component number 5 "has type": conv 
Component number 5 "has description":  3  
Component number 5 "has type": conv 
Component number 5 "has description": 2x2  relu 
Component number 8 "has type": input 
Component number 8 "has description":   
Component number 4 "has description": l1 
Component number 4 "has type": input 
Component number 4 "has description":   
Component number 3 "has description": 407 
Component number 3 "has type": conv 
Component number 3 "has description":   
Component number 3 "has description": relu 
Component number 3 "has type": conv 
Component number 3 "has description": 7x7  
Component number 3 "has type": maxpool 
Component number 3 "has description": 2x22x ing 
Component number 2 "has description": 1444 
Component number 2 "has type": conv 
Component number 2 "has description":   
Component number 2 "has description": relu 
Component number 2 "has type": conv 
Component number 2 "has description": x5 5x5 
Component number 2 "has type": maxpool 
Component number 2 "has description": 2x2 ing 
Component number 1 "has description": 2887 
Component number 1 "has type": conv 
Component number 1 "has description":   
Component number 1 "has description": relu 
Component number 1 "has type": conv 
Component number 1 "has description": 2x2in  
Component number 0 "has description": 367 
Component number 0 "has type": conv 
Component number 0 "has description":  4  
Component number 0 "has type": conv 
Component number 0 "has description": 1x1  
Text Component: hognet  
Text Component: convnet  
Component number 8 "connected to" Component number 7 
Component number 3 "connected to" Component number 4 
Component number 7 "connected to" Component number 6 
Component number 3 "connected to" Component number 2 
Component number 6 "connected to" Component number 5 
Component number 2 "connected to" Component number 1 
Component number 1 "connected to" Component number 0 
```
